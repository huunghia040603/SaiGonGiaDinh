{% extends "dichvusinhvien/base_dvsv.html" %}

{% block content %}

<main class="main-content8 container8" style="background-color: #f8f9fa;">
    <h1 class="page-title8">Cổng Dịch Vụ Sinh Viên</h1>
    <p class="page-description8">Chọn dịch vụ bạn cần từ các danh mục bên dưới.</p>

    <section class="service-category8">
        <h2 class="category-title8"><i class="fas fa-globe"></i> Dịch vụ Online</h2>
        <div class="service-grid8">
           
           
            <div class="service-card8" data-service="dang-ky-chung-nhan">
                <i class="fas fa-certificate icon8"></i>
                <h3>Đăng ký giấy hoãn NVQS</h3>
                <p>Yêu cầu cấp giấy hoãn NVQS.</p>
            </div>

            <div class="service-card8" data-service="dang-ky-the-sinh-vien">
                <i class="fas fa-id-card icon8"></i>
                <h3>Đăng ký chứng nhận Sinh Viên</h3>
                <p>Yêu cầu cấp chứng nhận Sinh Viên.</p>
            </div>

            <div class="service-card8" data-service="dang-ky-xac-nhan-vay-von">
                <i class="fas fa-hand-holding-usd icon8"></i>
                <h3>Đăng ký xác nhận vay vốn</h3>
                <p>Yêu cầu giấy xác nhận vay vốn.</p>
            </div>

                    
            
        </div>
        <div class="container">
                    <h1>Tra cứu trạng thái cấp hồ sơ</h1>
                    <form id="searchForm">
                        <div class="form-group">
                            <label for="search_input">Tìm theo Mã hồ sơ, Họ tên hoặc CCCD</label>
                            <input type="text" id="search_input" name="search_input" required placeholder="Ví dụ: SGC-09L31, Nguyễn Văn A hoặc 012345678912">
                        </div>
                        <button type="submit" class="btn-submit">
                            Tra Cứu
                        </button>
                    </form>

                    <div id="resultContainer" class="result-container">
                        <h2>Thông Tin Hồ Sơ</h2>
                        <div id="hoso-info" class="hoso-info">
                            </div>
                        <p id="error-message" class="error-message"></p>
                    </div>
                </div>
    </section>



<style>
    /* CSS đã được tối ưu hóa để chỉ chứa các quy tắc cần thiết cho trang này */
    /* Import Google Fonts cho một giao diện hiện đại */
    @font-face {
        font-family: 'font2';
        src: url('/static/fonts/font2.ttf') format('truetype');
    }
    @font-face {
        font-family: 'font6';
        src: url('/static/fonts/font6.ttf') format('truetype');
    }
    
    /* Các biến CSS để dễ dàng thay đổi màu sắc */
    :root {
        --primary-color8: #007bff;
        --secondary-color8: #6c757d;
        --accent-color8: #28a745;
        --bg-light8: #f8f9fa;
        --text-dark8: #212529;
        --card-bg8: #ffffff;
        --card-shadow8: rgba(0, 0, 0, 0.08);
        --hover-shadow8: rgba(0, 0, 0, 0.15);
        --status-processing: #ffc107; /* Vàng */
        --status-processed: #28a745; /* Xanh lá */
        --status-cancelled: #dc3545; /* Đỏ */
    }
    
    /* Container chính và bố cục */
    .container8 {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        font-family: 'font2';
    }
    .main-content8 {
        padding: 40px 0;
    }
    
    /* Tiêu đề và mô tả trang */
    .page-title8 {
        text-align: center;
        font-size: 2.8em;
        color: var(--primary-color8);
        margin-bottom: 10px;
        font-weight: 700;
        font-family: 'font2';
    }
    .page-description8 {
        text-align: center;
        font-size: 1.1em;
        color: var(--secondary-color8);
        margin-bottom: 50px;
    }
    
    /* Khối danh mục dịch vụ */
    .service-category8 {
        background-color: var(--card-bg8);
        border-radius: 12px;
        box-shadow: 0 8px 20px var(--card-shadow8);
        margin-bottom: 40px;
        padding: 30px;
    }
    .category-title8 {
        color: var(--text-dark8);
        font-size: 2.2em;
        margin-top: 0;
        margin-bottom: 30px;
        border-bottom: 3px solid var(--primary-color8);
        padding-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .category-title8 .fas, .category-title8 .fa-solid {
        color: var(--primary-color8);
        font-size: 1.2em;
    }
    
    /* Lưới (grid) các thẻ dịch vụ */
    .service-grid8 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
    }
    
    /* Thẻ dịch vụ */
    .service-card8 {
        background-color: var(--bg-light8);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    .service-card8 .icon8 {
        font-size: 3.5em;
        color: var(--primary-color8);
        margin-bottom: 15px;
        transition: color 0.3s ease;
    }
    .service-card8 h3 {
        color: var(--text-dark8);
        font-size: 1.5em;
        margin-top: 0;
        margin-bottom: 10px;
        font-weight: 600;
    }
    .service-card8 p {
        color: var(--secondary-color8);
        font-size: 1em;
        line-height: 1.5;
        font-family: 'font6';
    }
    
    /* Hiệu ứng tương tác */
    .service-card8:hover {
        transform: translateY(-12px);
        box-shadow: 0 15px 30px var(--hover-shadow8);
    }
    .service-card8:hover .icon8 {
        color: var(--accent-color8);
    }
    .service-card8:active {
        transform: translateY(-6px);
        box-shadow: 0 8px 15px var(--card-shadow8);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .container8 {
            padding: 0 15px;
            margin-left: auto;
            margin-right: auto;
        }
        .main-content8 {
            padding: 30px 0;
            margin-left: 0;
        }
        .page-title8 { font-size: 2em; margin-bottom: 5px; }
        .page-description8 { font-size: 0.9em; margin-bottom: 30px; }
        .service-category8 { padding: 20px; margin-bottom: 25px; }
        .category-title8 { font-size: 1.6em; gap: 10px; margin-bottom: 20px; }
        .category-title8 .fas { font-size: 1em; }
        .service-grid8 {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .service-card8 {
            padding: 15px;
            height: 150px;
            justify-content: flex-start;
        }
        .service-card8 .icon8 { font-size: 2.5em; margin-bottom: 10px; }
        .service-card8 h3 { font-size: 1.1em; margin-bottom: 5px; line-height: 1.3; }
        .service-card8 p {
            font-size: 0.8em;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    }
    @media (max-width: 480px) {
        .main-content8 { padding: 25px 10px; }
        .page-title8 { font-size: 1.8em; }
        .page-description8 { font-size: 0.85em; margin-bottom: 25px; }
        .category-title8 { font-size: 1.4em; }
        .service-grid8 {
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 10px;
        }
        .service-card8 { padding: 12px; height: 140px; }
        .service-card8 .icon8 { font-size: 2.2em; margin-bottom: 8px; }
        .service-card8 h3 { font-size: 1em; }
        .service-card8 p { font-size: 0.75em; }
    }
    
    /* Xóa các quy tắc lề trái không cần thiết, vì nó sẽ gây lỗi responsive */
    @media (min-width: 1721px), (max-width: 1720px), (max-width: 1620px), (max-width: 1000px), (max-width: 768px) {
        .main-content8 {
            margin-left: auto;
        }
    }

    /* === Quy tắc CSS mới cho khối tra cứu hồ sơ === */
    .container {
        width: 100%;
        max-width: 800px;
        background-color: #ffffff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin: 40px auto;
        transition: transform 0.3s ease-in-out;
        font-family: 'font6'; /* Giữ font chữ như đã yêu cầu */
    }
    .container:hover {
        transform: translateY(-5px);
    }
    .container h1 {
        font-size: 2.2rem;
        font-weight: 700;
        color: #333;
        text-align: center;
        margin-bottom: 25px;
        font-family: 'font2'; /* Áp dụng font chữ tiêu đề */
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-group label {
        display: block;
        font-size: 1rem;
        color: #555;
        margin-bottom: 8px;
        font-weight: 600;
        font-family: 'font6';
    }
    .form-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s, box-shadow 0.3s;
        font-family: 'font6';
    }
    .form-group input:focus {
        outline: none;
        border-color: #4a90e2;
        box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
    }
    .btn-submit {
        width: 100%;
        padding: 12px;
        background-color: #4a90e2;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s;
        font-family: 'font6';
    }
    .btn-submit:hover {
        background-color: #3b7ad1;
        transform: translateY(-2px);
    }
    .result-container {
        margin-top: 2rem;
        border-top: 2px solid #e9ecef;
        padding-top: 2rem;
        display: none;
    }
    .result-container h2 {
        font-size: 1.8rem;
        color: var(--primary-color8);
        margin-bottom: 1.5rem;
        text-align: center;
        font-family: 'font2';
    }
    .hoso-info {
        background-color: #f0f8ff;
        border: 1px solid #cce5ff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
        font-family: 'font6'; /* Giữ font chữ cho nội dung */
    }
    .hoso-info p {
        font-size: 1.1rem;
        line-height: 1.6;
        margin: 0;
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .hoso-info p:last-child {
        border-bottom: none;
    }
    .hoso-info strong {
        color: var(--primary-color8);
        min-width: 150px;
        display: inline-block;
        font-family: 'font2'; /* Font cho tiêu đề */
    }
    .status-badge {
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 12px;
        color: #10075c;
        text-transform: uppercase;
        font-size: 1rem;
        font-family: 'font6';
    }
    .status-badge.processing {
        background-color: var(--status-processing);
    }
    .status-badge.processed {
        background-color: var(--status-processed);
    }
    .status-badge.cancelled {
        background-color: var(--status-cancelled);
    }
    .error-message {
        color: var(--status-cancelled);
        text-align: center;
        font-weight: 600;
        margin-top: 1rem;
        font-size: 1.1rem;
        font-family: 'font6';
    }
    @media (max-width: 576px) {
        .hoso-info p {
            flex-direction: column;
            align-items: flex-start;
        }
        .hoso-info strong {
            margin-bottom: 5px;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('search_input');
        const resultContainer = document.getElementById('resultContainer');
        const hosoInfoDiv = document.getElementById('hoso-info');
        const errorMessageP = document.getElementById('error-message');

        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const searchTerm = searchInput.value.trim();
            if (!searchTerm) {
                return;
            }

            hosoInfoDiv.innerHTML = '';
            errorMessageP.textContent = '';
            resultContainer.style.display = 'none';

            hosoInfoDiv.innerHTML = '<p style="text-align: center; color: #555;">Đang tra cứu...</p>';
            resultContainer.style.display = 'block';

            try {
                // Lấy tất cả hồ sơ và tìm kiếm local
                const response = await fetch('https://saigongiadinh.pythonanywhere.com/hoso/');
                const data = await response.json();

                if (data && Array.isArray(data)) {
                    // Tìm kiếm theo nhiều tiêu chí
                    const searchTermLower = searchTerm.toLowerCase();
                    const foundHoso = data.find(hoso => {
                        return (
                            (hoso.ma_ho_so && hoso.ma_ho_so.toLowerCase().includes(searchTermLower)) ||
                            (hoso.full_name && hoso.full_name.toLowerCase().includes(searchTermLower)) ||
                            (hoso.cccd && hoso.cccd.toLowerCase().includes(searchTermLower))
                        );
                    });

                    if (foundHoso) {
                        hosoInfoDiv.innerHTML = `
                            <p><strong>Mã hồ sơ:</strong> <span>${foundHoso.ma_ho_so}</span></p>
                            <p><strong>Họ và tên:</strong> <span>${foundHoso.full_name}</span></p>
                            <p><strong>CCCD:</strong> <span>${foundHoso.cccd || 'Chưa cập nhật'}</span></p>
                            <p><strong>Ngày đăng ký:</strong> <span>${new Date(foundHoso.submission_date).toLocaleDateString('vi-VN')}</span></p>
                            <p><strong>Tình trạng:</strong> <span class="status-badge ${foundHoso.trang_thai}">${getTrangThaiText(foundHoso.trang_thai)}</span></p>
                            <p><strong>Giấy tờ đã đăng ký:</strong> <span>${getServiceNames(foundHoso)}</span></p>
                        `;
                    } else {
                        hosoInfoDiv.innerHTML = '';
                        errorMessageP.textContent = 'Không tìm thấy hồ sơ phù hợp. Vui lòng kiểm tra lại thông tin tìm kiếm.';
                    }
                } else {
                    hosoInfoDiv.innerHTML = '';
                    errorMessageP.textContent = 'Không thể tải dữ liệu. Vui lòng thử lại sau.';
                }
            } catch (error) {
                console.error('Lỗi khi tra cứu:', error);
                hosoInfoDiv.innerHTML = '';
                errorMessageP.textContent = 'Đã xảy ra lỗi khi kết nối. Vui lòng thử lại sau.';
            }

            // Reset ô nhập liệu sau khi tra cứu
            searchInput.value = '';
        });

        function getServiceNames(hoso) {
            const services = [];
            if (hoso.giay_chung_nhan_sv) {
                services.push('Giấy chứng nhận sinh viên');
            }
            if (hoso.giay_hoan_nvqs) {
                services.push('Giấy hoãn nghĩa vụ quân sự');
            }
            if (hoso.yeu_cau_vay_von) {
                services.push('Giấy xác nhận vay vốn');
            }
            return services.length > 0 ? services.join(', ') : 'Không có';
        }

        // Hàm chuyển đổi giá trị 'trang_thai' thành văn bản dễ đọc
        function getTrangThaiText(trangThai) {
            switch (trangThai) {
                case 'dang_xu_ly':
                    return 'Đang xử lý';
                case 'da_xu_ly':
                    return 'Đã xử lý';
                case 'da_huy':
                    return 'Đã hủy';
                default:
                    return trangThai;
            }
        }
    });
</script>

<script src="{{ url_for('static', filename='js/dichvusinhvien/dichvuhoso.js') }}"></script>
{% endblock %}